import{_ as q,r as _,J as K,f,c as o,o as r,a as e,t as E,g as ie,w as G,v as D,M as se,b as I,U as oe,V as Me,W as Ie,X as Fe,s as ue,l as u,F as L,A as U,q as ce,L as ve,j as pe,p as O,h as me,z as ge,d as ee,x as Be,u as S,N as Ve,Y as Te,Q as je,T as Ae,O as R,S as Z}from"./index-5qBkxSW0.js";import{_ as te}from"./InfoRow-DtrQbEPc.js";import{_ as A}from"./StatCard-Bma8krAD.js";import{c as fe,f as Le,u as xe,a as T,d as de,_ as z}from"./InputField.vue_vue_type_script_setup_true_lang-DUWT9aqn.js";import{d as P,N as J}from"./NewCustomSelect-CC-W8vso.js";const Oe={class:"flex flex-col h-[116px] rounded-[12px] gap-4 w-full bg-white p-4"},ze={class:"flex justify-between items-center"},qe={class:"flex items-center gap-2"},Ne={class:"text-xl font-medium"},Ue={__name:"statusCard",props:{title:{type:String,default:""},value:{type:String,default:""}},emits:["update:value","change"],setup(m,{emit:g}){const c=m,h=g,n=_(c.value);K(()=>c.value,a=>{n.value=a});const d={paid:"مدفوع",cod:"الدفع عند الاستلام",remaining_fees:"رسوم متبقية",active:"نشط",inactive:"غير نشط",created:"تم إنشاء الطلب",assigned_to_driver:"تم تعيين المندوب",in_progress:"قيد التوصيل",delivered:"تم التوصيل",cancelled:"تم الإلغاء",postponed:"تم التأجيل"},w={paid:"bg-green-100 text-green-700",cod:"bg-blue-100 text-blue-700",remaining_fees:"bg-yellow-100 text-yellow-700",active:"bg-green-100 text-green-700 rounded-full",inactive:"bg-red-100 text-red-700 rounded-full",created:"bg-gray-100 text-gray-700",assigned_to_driver:"bg-indigo-100 text-indigo-700",in_progress:"bg-blue-100 text-blue-700",delivered:"bg-green-100 text-green-700",cancelled:"bg-red-100 text-red-700",postponed:"bg-yellow-100 text-yellow-700"},v=f(()=>[{value:"active",label:d.active},{value:"inactive",label:d.inactive}]),l=f(()=>n.value==="active"||n.value==="inactive"),x=f(()=>d[n.value]||n.value),b=f(()=>w[n.value]||"bg-gray-100 text-gray-600"),M=a=>{n.value=a,h("update:value",a),h("change",a)},i=a=>w[a]||"bg-gray-100 text-gray-600";return(a,$)=>(r(),o("div",Oe,[e("div",ze,[e("div",qe,[e("span",Ne,E(m.title),1)])]),e("div",null,[l.value?(r(),ie(se,{key:0,modelValue:n.value,"onUpdate:modelValue":[$[0]||($[0]=B=>n.value=B),M],options:v.value,class:D(["status-select",b.value])},{option:G(({option:B,isSelected:V})=>[e("span",{class:D(["text-lg px-3 py-2 rounded-full inline-block",i(B.value)])},E(B.label),3)]),_:1},8,["modelValue","options","class"])):(r(),o("span",{key:1,class:D(["text-lg px-3 py-2 rounded-full",b.value])},E(x.value),3))])]))}},Ge=q(Ue,[["__scopeId","data-v-54e7351e"]]),He={class:"flex flex-col h-[116px] rounded-[12px] gap-4 w-full bg-white p-4"},Re={class:"flex justify-between items-center"},Ze={class:"flex items-center gap-2"},Pe={class:"text-xl font-medium"},Je={class:"w-[50%]"},Ke={__name:"statusCardShipment",props:{title:{type:String,default:""},value:{type:String,default:""},editable:{type:Boolean,default:!1}},emits:["update:value","change"],setup(m,{emit:g}){const c=m,h=g,n=_(c.value);K(()=>c.value,i=>{n.value=i});const d={paid:"مدفوع",cod:"الدفع عند الاستلام",remaining_fees:"رسوم متبقية",active:"نشط",inactive:"غير نشط",suspended:"موقوف",created:"غير مسنوده",assigned_to_driver:"تم تعيين المندوب",delivered:"تم التوصيل",cancelled:"تم الإلغاء",postponed:"تم التأجيل"},w={paid:"bg-green-100 text-green-700",cod:"bg-blue-100 text-blue-700",remaining_fees:"bg-yellow-100 text-yellow-700",active:"bg-green-100 text-green-700 rounded-full",inactive:"bg-red-100 text-red-700 rounded-full",suspended:"bg-yellow-200 text-yellow-700 rounded-full",created:"bg-gray-100 text-gray-700",assigned_to_driver:"bg-indigo-100 text-indigo-700",delivered:"bg-green-100 text-green-700",cancelled:"bg-red-100 text-red-700",postponed:"bg-yellow-100 text-yellow-700"},v=f(()=>{const i=[{value:"created",label:d.created},{value:"delivered",label:d.delivered},{value:"cancelled",label:d.cancelled},{value:"postponed",label:d.postponed}];return c.value==="assigned_to_driver"&&i.push({value:"assigned_to_driver",label:d.assigned_to_driver,disabled:!0}),i});f(()=>n.value==="created"||n.value==="assigned_to_driver"||n.value==="delivered"||n.value==="cancelled"||n.value==="postponed");const l=f(()=>d[n.value]||n.value),x=f(()=>w[n.value]||"bg-gray-100 text-gray-600"),b=i=>{n.value=i,h("update:value",i),h("change",i)},M=i=>w[i]||"bg-gray-100 text-gray-600";return(i,a)=>(r(),o("div",He,[e("div",Re,[e("div",Ze,[e("span",Pe,E(m.title),1)])]),e("div",Je,[m.editable?(r(),ie(se,{key:0,modelValue:n.value,"onUpdate:modelValue":[a[0]||(a[0]=$=>n.value=$),b],options:v.value,class:D(["status-select bg-white border rounded-full w-fit",x.value])},{option:G(({option:$,isSelected:B,isDisabled:V})=>[e("span",{class:D(["text-lg px-3 py-2 rounded-full inline-block",[M($.value),{"opacity-50":V}]])},E($.label),3)]),_:1},8,["modelValue","options","class"])):(r(),o("span",{key:1,class:D(["text-lg px-3 py-2 rounded-full",x.value])},E(l.value),3))])]))}},Qe=q(Ke,[["__scopeId","data-v-91aa51f7"]]),We={class:"flex flex-col items-start"},Xe={class:"bg-white p-4 rounded-2xl shadow-sm w-full h-full"},Ye={key:0,class:"w-full h-[350px] rounded-xl overflow-hidden"},et=["src"],tt={key:1,class:"flex flex-col items-center justify-center h-[350px] text-center bg-red-50 rounded-xl"},st={__name:"Map",props:{status:{type:String,required:!0},lat:Number,lng:Number},setup(m){const g=m,c={created:"تم إنشاء الطلب",assigned_to_driver:"تم تعيين المندوب",in_progress:"قيد التوصيل",delivered:"تم التسليم",cancelled:"ملغي",postponed:"تم تأجيل استلام الشحنة"},h={created:"#3B82F6",assigned_to_driver:"#8B5CF6",in_progress:"#F59E0B",delivered:"#10B981",cancelled:"#EF4444",postponed:"#F59E0B"};f(()=>c[g.status]||g.status),f(()=>h[g.status]||"#F06623");const n=f(()=>g.lat!=null&&g.lng!=null&&g.lat!==0&&g.lng!==0),d=f(()=>n.value?`https://www.google.com/maps?q=${g.lat},${g.lng}&z=15&output=embed`:"");return(w,v)=>(r(),o("div",We,[v[1]||(v[1]=e("h3",{class:"text-lg font-bold mb-4 text-gray-800 text-start"}," موقع التسليم ",-1)),e("div",Xe,[n.value?(r(),o("div",Ye,[e("iframe",{src:d.value,class:"w-full h-full border-0 rounded-xl",allowfullscreen:"",loading:"lazy",referrerpolicy:"no-referrer-when-downgrade"},null,8,et)])):n.value?I("",!0):(r(),o("div",tt,[...v[0]||(v[0]=[e("svg",{class:"w-16 h-16 text-red-500 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),e("p",{class:"text-red-600 text-lg font-semibold mb-2"}," خطأ في بيانات الموقع ",-1),e("p",{class:"text-gray-600 text-sm"}," الإحداثيات الجغرافية غير متوفرة أو غير صحيحة ",-1)])]))])]))}},lt=q(st,[["__scopeId","data-v-82a2d684"]]),at={class:"flex flex-col items-start w-full h-full"},rt={class:"bg-white p-4 rounded-2xl shadow-sm w-full h-full"},nt={class:"relative flex flex-col items-start"},ot=["innerHTML"],dt={class:"flex flex-col"},it={key:0,class:"text-sm text-red-500 mt-1"},ut={key:1,class:"text-sm text-orange-500 mt-1"},ct={class:"h-[90vh] flex items-center justify-center rounded-xl"},vt=["src"],pt={__name:"orderStatus",props:{status:{type:String,required:!0},orderInfo:{type:Object,required:!0}},setup(m){const g=m,c=[{key:"created",label:"تم إنشاء الطلب",icon:Ie},{key:"assigned_to_driver",label:"تم تعيين المندوب",icon:Fe}],h=_(!1),n={delivered:{key:"delivered",label:"تم التوصيل",icon:Me},cancelled:{key:"cancelled",label:"تم الإلغاء",icon:oe},postponed:{key:"postponed",label:"تم التأجيل",icon:oe}},d=f(()=>{const x=[...c],b=n[g.status]||n.delivered;return x.push(b),x}),w=f(()=>d.value.findIndex(x=>x.key===g.status)),v=x=>x<w.value,l=x=>x===w.value;return(x,b)=>{const M=ue("GenericModal");return r(),o("div",at,[b[3]||(b[3]=e("h3",{class:"text-lg font-bold mb-4 text-gray-800 text-start"},"تتبع الطلب",-1)),e("div",rt,[e("div",nt,[(r(!0),o(L,null,U(d.value,(i,a)=>(r(),o("div",{key:a,class:"flex items-center gap-3 mb-6 last:mb-0 relative"},[a!==d.value.length-1?(r(),o("div",{key:0,class:D(["absolute start-3 transform -translate-x-1/2 top-8 w-0.5 h-10",v(a)||l(a)?"bg-[#0E5895]":"bg-[#EFEFEF]"])},null,2)):I("",!0),e("div",{class:D(["flex items-center justify-center w-8 h-8 rounded-full z-10",[v(a)||l(a)?"bg-[#0E5895] text-white":"bg-[#EFEFEF] text-gray-400"]])},[e("div",{innerHTML:i.icon},null,8,ot)],2),e("div",dt,[e("span",{class:D(["font-medium",[v(a)||l(a)?"text-gray-800":"text-gray-400"]])},E(i.label),3),i.key==="cancelled"&&m.orderInfo.cancel_reason?(r(),o("span",it," سبب الإلغاء: "+E(m.orderInfo.cancel_reason),1)):I("",!0),i.key==="postponed"&&m.orderInfo.postpone_reason?(r(),o("span",ut," سبب التأجيل: "+E(m.orderInfo.postpone_reason),1)):I("",!0),m.orderInfo.image&&a===d.value.length-1?(r(),o("a",{key:2,class:"text-sm text-info-500 mt-1 underline hover:cursor-pointer",onClick:b[0]||(b[0]=$=>h.value=!0)}," عرض السبب ")):I("",!0)])]))),128))]),u(M,{modelValue:h.value,"onUpdate:modelValue":b[1]||(b[1]=i=>h.value=i),"show-header-icon":!0,size:"large","show-footer":!1,onClose:b[2]||(b[2]=i=>h.value=!1)},{default:G(()=>[e("div",ct,[e("img",{src:m.orderInfo.image,alt:"no image",class:"w-1/2 h-auto object-contain"},null,8,vt)])]),_:1},8,["modelValue"])])])}}},mt=q(pt,[["__scopeId","data-v-4736fc6b"]]),gt={class:"driver-assignment-container"},ft={class:"flex items-center justify-between"},xt={class:"flex items-center gap-2"},bt={key:0,class:"no-driver-state"},_t={key:1,class:"driver-info"},yt={class:"flex flex-col gap-4 justify-between min-h-[300px]"},ht={class:"flex justify-end items-center w-full gap-2 mt-4"},wt=["disabled"],kt={key:0},$t={key:1},Ct={__name:"AssignToDriver",props:{driver:{type:Object,default:null},shipmentTrackingNumber:{type:String,default:null},status:{type:String,default:null}},emits:["driver-assigned"],setup(m,{emit:g}){const c=m,h=g,n=ce(),d=ve(),w=pe(),v=_(!1),l=_(!1),x=_([]),b=fe({driver_id:Le().required("يرجى اختيار السائق")}),{handleSubmit:M,defineField:i,errors:a,resetForm:$,setValues:B}=xe({validationSchema:b,initialValues:{driver_id:null}}),[V]=i("driver_id"),le=()=>{n.push({name:"view-one-delivery",params:{id:c.driver.id}})},Q=()=>{c.driver&&B({driver_id:c.driver.id}),v.value=!0},W=f(()=>d.params.id),N=f(()=>c.driver&&c.driver.id),ae=f(()=>c.driver?[{label:"الاسم",value:c.driver.full_name},{label:"البريد الإلكتروني",value:c.driver.email},{label:"رقم التعريف",value:c.driver.id}]:[]),X=f(()=>x.value.map(F=>({label:F.full_name||`#${F.id}`,value:F.id}))),Y=()=>{$(),v.value=!0},j=async()=>{try{const F=await O.get("drivers/?no_paginate=true&is_active=true");x.value=F.data.results}catch{w.error("⚠️ فشل في تحميل قائمة السائقين")}},H=M(async F=>{if(l.value=!0,!W.value){w.error("لا يوجد رقم شحنة"),l.value=!1;return}const p={driver:F.driver_id};try{await O.patch(`orders/${W.value}/`,p),w.success("✅ تم تعين السائق بنجاح"),v.value=!1,h("driver-assigned")}catch(C){w.error(C.response?.data?.message||"حدث خطأ أثناء تعين السائق")}finally{l.value=!1}});return me(()=>{j()}),(F,p)=>(r(),o("div",gt,[e("div",ft,[p[5]||(p[5]=e("h2",{class:"section-title"},"معلومات المندوب",-1)),e("div",xt,[N.value&&m.status!=="delivered"&&m.status!=="cancelled"?(r(),o("button",{key:0,onClick:Q,class:"bg-[#3B5998] text-white rounded-xl px-3 p-2 flex items-center gap-2 cursor-pointer"}," إعادة تعيين ")):I("",!0),N.value?(r(),o("button",{key:1,onClick:le,class:"bg-white rounded-xl px-3 p-2 flex items-center gap-2 cursor-pointer"}," عرض المندوب ")):I("",!0)])]),N.value?(r(),o("div",_t,[u(te,{data:ae.value},null,8,["data"])])):(r(),o("div",bt,[p[7]||(p[7]=ge('<p class="no-driver-message" data-v-2d759a10>لم يتم تعيين مندوب بعد</p><div class="illustration-container" data-v-2d759a10><svg width="200" height="160" viewBox="0 0 200 160" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-2d759a10><rect x="20" y="30" width="60" height="80" rx="4" fill="#E8EEF4" data-v-2d759a10></rect><rect x="25" y="35" width="50" height="8" rx="2" fill="#D1DCE8" data-v-2d759a10></rect><rect x="25" y="48" width="40" height="6" rx="2" fill="#D1DCE8" data-v-2d759a10></rect><rect x="25" y="58" width="45" height="6" rx="2" fill="#D1DCE8" data-v-2d759a10></rect><rect x="25" y="68" width="35" height="6" rx="2" fill="#D1DCE8" data-v-2d759a10></rect><rect x="25" y="78" width="50" height="6" rx="2" fill="#D1DCE8" data-v-2d759a10></rect><rect x="25" y="88" width="40" height="6" rx="2" fill="#D1DCE8" data-v-2d759a10></rect><rect x="25" y="98" width="45" height="6" rx="2" fill="#D1DCE8" data-v-2d759a10></rect><rect x="130" y="20" width="50" height="60" rx="4" fill="#F5F7FA" data-v-2d759a10></rect><rect x="135" y="30" width="40" height="4" rx="1" fill="#D1DCE8" data-v-2d759a10></rect><rect x="135" y="38" width="35" height="4" rx="1" fill="#D1DCE8" data-v-2d759a10></rect><rect x="135" y="46" width="38" height="4" rx="1" fill="#D1DCE8" data-v-2d759a10></rect><circle cx="155" cy="55" r="22" fill="#F0F4F8" stroke="#D1DCE8" stroke-width="2" data-v-2d759a10></circle><circle cx="155" cy="55" r="18" fill="white" data-v-2d759a10></circle><line x1="155" y1="55" x2="155" y2="43" stroke="#6B8299" stroke-width="2" stroke-linecap="round" data-v-2d759a10></line><line x1="155" y1="55" x2="163" y2="55" stroke="#6B8299" stroke-width="2" stroke-linecap="round" data-v-2d759a10></line><circle cx="155" cy="55" r="2" fill="#4A7AB0" data-v-2d759a10></circle><g transform="translate(85, 50)" data-v-2d759a10><path d="M5 0 L35 0 L28 25 L12 25 Z" fill="#A8C4E0" data-v-2d759a10></path><rect x="15" y="25" width="10" height="4" fill="#3B5E8C" data-v-2d759a10></rect><path d="M12 29 L28 29 L35 68 L5 68 Z" fill="#A8C4E0" data-v-2d759a10></path><path d="M10 5 L30 5 L25 20 L15 20 Z" fill="#D4E4F2" data-v-2d759a10></path><rect x="18" y="25" width="4" height="10" fill="#6B9BD1" data-v-2d759a10></rect><path d="M15 50 L25 50 L30 63 L10 63 Z" fill="#6B9BD1" data-v-2d759a10></path></g></svg></div>',2)),e("button",{onClick:Y,class:"assign-driver-btn"},[...p[6]||(p[6]=[e("span",{class:"plus-icon"},"+",-1),ee(" تعيين مندوب للشحنة ",-1)])])])),u(Te,{modelValue:v.value,"onUpdate:modelValue":p[3]||(p[3]=C=>v.value=C),title:"تعين لسائق",description:"اختر السائق المناسب للشحنة","show-header-icon":!0,size:"large","show-footer":!1,onClose:p[4]||(p[4]=C=>v.value=!1)},{default:G(()=>[e("form",{onSubmit:p[2]||(p[2]=Be((...C)=>S(H)&&S(H)(...C),["prevent"]))},[e("div",yt,[e("div",null,[p[8]||(p[8]=e("label",{class:"block text-sm font-medium mb-1"},"اختر السائق",-1)),u(se,{modelValue:S(V),"onUpdate:modelValue":p[0]||(p[0]=C=>Ve(V)?V.value=C:null),options:X.value,placeholder:"اختر السائق",searchable:"",error:S(a).driver_id},null,8,["modelValue","options","error"])]),e("div",ht,[e("button",{onClick:p[1]||(p[1]=C=>v.value=!1),type:"button",class:"w-fit px-8 py-2 text-black bg-[#DEDEDE] rounded-[12px]"}," إلغاء "),e("button",{type:"submit",class:"w-[160px] px-4 py-2 text-white disabled:opacity-50 disabled:cursor-not-allowed bg-[#0E5895] rounded-[12px]",disabled:l.value},[l.value?(r(),o("span",kt,"جاري ...")):(r(),o("span",$t,"تأكيد التعين"))],8,wt)])])],32)]),_:1},8,["modelValue"])]))}},Et=q(Ct,[["__scopeId","data-v-2d759a10"]]),Dt={class:"flex flex-col w-full gap-4 overflow-y-auto"},St={class:"grid grid-cols-1 lg:grid-cols-5 gap-4 w-full"},Mt={class:"grid grid-cols-1 gap-4 mb-2"},It={class:"skeleton-info-row"},Ft={class:"skeleton-info-row"},Bt={class:"grid grid-cols-12 gap-4 mb-2 items-stretch"},Vt={class:"skeleton-status-tracker col-span-12 lg:col-span-12 xl:col-span-6 2xl:col-span-3"},Tt={class:"flex flex-col gap-3"},jt={class:"flex justify-between items-center w-full pt-8"},At={class:"flex gap-2 items-center"},Lt={class:"text-xl font-semibold"},Ot={class:"px-2 text-blue-600"},zt=["disabled"],qt={class:"grid grid-cols-1 lg:grid-cols-5 gap-4 w-full"},Nt={class:"w-full flex gap-4"},Ut={class:"grid grid-cols-1 gap-4 mb-2"},Gt={class:"gird grid-cols-12 gap-4"},Ht={key:0,class:"grid grid-cols-12 gap-4 mb-2 items-stretch"},Rt={class:"flex flex-col gap-4",dir:"rtl"},Zt={class:"border border-gray-200 rounded-xl"},Pt=["src"],Jt={class:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4"},Kt={class:"border border-gray-200 rounded-xl"},Qt=["src"],Wt={class:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4"},Xt={class:"border border-gray-200 rounded-xl"},Yt=["src"],es={class:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4"},ts={class:"border border-gray-200 rounded-xl"},ss=["src"],ls={class:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4"},as={key:0},rs={key:0,class:"text-red-500 text-sm text-end mt-2"},ns={key:1,class:"text-green-600 text-sm text-end mt-2"},os={class:"flex justify-end items-center w-full gap-2 mt-4"},ds=["disabled"],is={key:0},us={key:1},cs={__name:"ViewOneShipments",setup(m){const g=je(),c=_(""),h=ve(),n=ce(),d=pe(),w=_([]),v=_([]),l=_([]),x=_(null),b=_(null),M=_(!0),i=_(!1);_(!1);const a=_("trader"),$=s=>{a.value=a.value===s?"":s},B=fe({trader_id:T().required("هذا الحقل مطلوب"),client_name:T().required("هذا الحقل مطلوب"),is_return:T().required("هذا الحقل مطلوب"),client_phone:T().required("هذا الحقل مطلوب").matches(/^[0-9]+$/,"يجب أن يحتوي على أرقام فقط"),region_id:T().required("هذا الحقل مطلوب"),address:T().required("هذا الحقل مطلوب"),shipment_code:T().required("هذا الحقل مطلوب"),products_value:de().transform((s,t)=>t===""?void 0:s).typeError("يجب أن يكون رقماً").required("هذا الحقل مطلوب"),extra_commission:de().transform((s,t)=>t===""?0:s).typeError("يجب أن يكون رقماً").default(0),payment_status:T().required("هذا الحقل مطلوب")}),{values:V,errors:le,handleSubmit:Q,resetForm:W,setValues:N,setFieldValue:ae}=xe({validationSchema:B,initialValues:{trader_id:"",client_name:"",client_phone:"",region_id:"",address:"",shipment_code:"",products_value:"",extra_commission:0,payment_status:"",driver_id:null,is_return:!1},keepValuesOnUnmount:!0}),X=[{label:"مدفوعة",value:"paid"},{label:"الدفع عند الاستلام",value:"cod"}],Y=()=>n.back(),j=async()=>{M.value=!0;try{const s={};c.value&&(s.date=c.value);const k=(await O.get(`orders/${h.params.id}/`,{params:s})).data;l.value=k,w.value=[{label:"الاسم",value:k?.trader?.full_name},{label:"البريد الإلكتروني",value:k?.trader?.email},{label:"رقم الهاتف",value:k?.trader?.phone_number},{label:"الرصيد",value:k?.trader?.balance}],v.value=[{label:"الاسم",value:k?.customer?.name},{label:"رقم الهاتف",value:k?.customer?.phone},{label:"العنوان",value:k?.customer?.address}],c.value&&d.info(` تم عرض البيانات لتاريخ ${c.value}`)}catch(s){console.error("Error fetching order:",s),d.error(" حدث خطأ أثناء تحميل بيانات التاجر")}finally{M.value=!1}},H=["created","assigned_to_driver"],F=s=>!H.includes(s),p=_([]),C=_([]),be=_([{id:!0,name:"نعم"},{id:!1,name:"لا"}]),_e=f(()=>p.value.map(s=>({label:s.full_name||`#${s.id}`,value:s.id}))),ye=f(()=>be.value.map(s=>({label:s.name,value:s.id}))),he=f(()=>C.value.map(s=>({label:s.name,value:s.id}))),we=async()=>{try{const s=await O.get("traders/?no_paginate=true&is_active=true");p.value=s.data.results}catch{d.error("⚠️ فشل في تحميل قائمة التجار")}},re=_(!0),ke=async s=>{if(s)try{const t=await O.get(`pricing/trader-delivery-zones/?no_paginate=true&trader=${s}`);C.value=t.data.results.map(k=>k.delivery_zone)}catch{d.error("⚠️ فشل في تحميل المناطق")}};K(()=>V.trader_id,async s=>{s?(await ke(s),re.value||(a.value="client"),re.value=!1):C.value=[]});const $e=()=>{a.value="trader",De()},Ce=()=>{n.push({name:"view-one-merchant",params:{id:l.value.trader.id}})};me(()=>{j(),we()}),K(c,s=>{s?j():d.warning("⚠️ برجاء اختيار تاريخ لعرض البيانات")});const Ee=s=>{const t={status:s};O.patch(`orders/${h.params.id}/`,t).then(k=>{j(),d.success("تم تحديث حالة الشحنة")}).catch(k=>{d.error("حدث خطأ أثناء تحديث حالة الشحنة")})},De=async()=>{try{const s=l.value;x.value=s.id,b.value=s.customer?.id,N({trader_id:s.trader?.id,client_name:s.customer?.name,client_phone:s.customer?.phone,region_id:s.delivery_zone?.id,address:s.customer?.address,shipment_code:s.reference_code,products_value:s.product_cost,extra_commission:s.extra_delivery_cost,payment_status:s.product_payment_status,is_return:s.is_return}),i.value=!0}catch{d.error(" حدث خطأ أثناء تحميل بيانات الشحنة")}},Se=Q(async s=>{const t={trader:s.trader_id,delivery_zone:s.region_id,reference_code:s.shipment_code,product_cost:s.products_value,extra_delivery_cost:s.extra_commission||0,product_payment_status:s.payment_status,customer:{id:b.value,name:s.client_name,phone:s.client_phone,address:s.address},is_return:s.is_return};try{await O.patch(`orders/${x.value}/`,t),d.success("✅ تم تعديل الشحنة بنجاح"),await j(),i.value=!1}catch(k){const y=k.response?.data||{};y.code==="validation_error"?handleValidationErrors(y.errors):d.error(y.message||"❌ حدث خطأ أثناء تعديل الشحنة")}finally{isloading.value=!1}}),ne=()=>{i.value=!1};return(s,t)=>{const k=ue("GenericModal");return r(),o("div",Dt,[M.value?(r(),o(L,{key:0},[t[15]||(t[15]=e("div",{class:"flex justify-between items-center w-full pt-8"},[e("div",{class:"flex gap-2 items-center"},[e("div",{class:"skeleton-box w-10 h-10 rounded-lg"}),e("div",{class:"skeleton-box w-48 h-6 rounded-md"})])],-1)),e("div",St,[(r(),o(L,null,U(5,y=>e("div",{key:y,class:"skeleton-card"},[...t[6]||(t[6]=[e("div",{class:"skeleton-box w-24 h-4 rounded mb-3"},null,-1),e("div",{class:"skeleton-box w-32 h-8 rounded"},null,-1)])])),64))]),e("div",Mt,[t[9]||(t[9]=e("div",{class:"skeleton-box w-32 h-6 rounded mt-5"},null,-1)),e("div",It,[(r(),o(L,null,U(5,y=>e("div",{key:y,class:"skeleton-info-item"},[...t[7]||(t[7]=[e("div",{class:"skeleton-box w-16 h-4 rounded mb-2"},null,-1),e("div",{class:"skeleton-box w-32 h-5 rounded"},null,-1)])])),64))]),t[10]||(t[10]=e("div",{class:"skeleton-box w-32 h-6 rounded mt-5"},null,-1)),e("div",Ft,[(r(),o(L,null,U(4,y=>e("div",{key:y,class:"skeleton-info-item"},[...t[8]||(t[8]=[e("div",{class:"skeleton-box w-16 h-4 rounded mb-2"},null,-1),e("div",{class:"skeleton-box w-32 h-5 rounded"},null,-1)])])),64))]),t[11]||(t[11]=ge('<div class="skeleton-box w-40 h-6 rounded mt-5" data-v-45e7d94e></div><div class="skeleton-driver-card" data-v-45e7d94e><div class="flex items-center gap-4" data-v-45e7d94e><div class="skeleton-box w-16 h-16 rounded-full" data-v-45e7d94e></div><div class="flex flex-col gap-2" data-v-45e7d94e><div class="skeleton-box w-32 h-5 rounded" data-v-45e7d94e></div><div class="skeleton-box w-24 h-4 rounded" data-v-45e7d94e></div></div></div></div>',2))]),e("div",Bt,[e("div",Vt,[t[13]||(t[13]=e("div",{class:"skeleton-box w-32 h-5 rounded mb-4"},null,-1)),e("div",Tt,[(r(),o(L,null,U(4,y=>e("div",{key:y,class:"flex items-center gap-3"},[...t[12]||(t[12]=[e("div",{class:"skeleton-box w-8 h-8 rounded-full"},null,-1),e("div",{class:"skeleton-box flex-1 h-4 rounded"},null,-1)])])),64))])]),t[14]||(t[14]=e("div",{class:"skeleton-map col-span-12 lg:col-span-12 xl:col-span-6 2xl:col-span-9"},[e("div",{class:"skeleton-box w-full h-full min-h-[300px] rounded-2xl"})],-1))])],64)):(r(),o(L,{key:1},[e("div",jt,[e("div",At,[e("img",{src:Ae,onClick:Y,alt:""}),e("h1",Lt,[ee(" الشحنة "+E(l.value?.reference_code)+" ",1),t[16]||(t[16]=e("span",{class:"text-blue-600"}," - ",-1)),t[17]||(t[17]=ee(" رقم التتبع ",-1)),e("span",Ot,E(l.value?.tracking_number),1)])]),e("div",null,[e("button",{class:"w px-4 py-3 mt-2 text-white bg-[#0E5895] rounded-[12px] focus:outline-none focus:shadow-outline",onClick:$e,disabled:F(l.value.status)},[...t[18]||(t[18]=[e("span",{class:"mx-2"},"تعديل علي الشحنة",-1)])],8,zt)])]),e("div",qt,[u(A,{title:" رسوم التحصيل",currency:"ج.م",value:l.value.total_cost,trend:"up"},null,8,["value"]),u(A,{title:"رسوم شحن المندوب",currency:"ج.م",value:l.value.delivery_cost,trend:"dawon"},null,8,["value"]),u(A,{title:"رسوم شحن التاجر ",currency:"ج.م",value:l.value?.trader_cost,trend:"up"},null,8,["value"]),u(A,{title:"بونص المندوب",currency:"ج.م",value:l.value.extra_delivery_cost,trend:"up"},null,8,["value"]),u(Ge,{title:"حاله الدفع",value:l.value.product_payment_status,trend:"up"},null,8,["value"])]),e("div",Nt,[u(A,{title:"سعر المنتج",currency:"ج.م",value:l.value.product_cost,trend:"up"},null,8,["value"]),u(A,{title:"نقطة الوصول",value:l.value.delivery_zone?.name,trend:"up"},null,8,["value"]),u(A,{title:"مرتجع",value:l.value.is_return?"مرتجع":"غير مرتجع",trend:"up"},null,8,["value"]),u(Qe,{title:"حاله الشحنة",value:l.value.status,onChange:Ee,trend:"up",class:"",editable:S(g).user?.role==="owner"},null,8,["value","editable"])]),e("div",Ut,[e("div",{class:"flex justify-between items-center"},[t[19]||(t[19]=e("h2",{style:{"font-family":"Almarai","font-weight":"600","font-style":"Bold","font-size":"20px","leading-trim":"CAP_HEIGHT","line-height":"100%","letter-spacing":"0%","text-align":"right","vertical-align":"middle"},class:"mt-5"}," معلومات التاجر ",-1)),e("button",{onClick:Ce,class:"bg-white rounded-xl px-3 p-2 flex items-center gap-2 cursor-pointer"}," عرض التاجر ")]),e("div",Gt,[u(te,{data:w.value,class:"col-span-2"},null,8,["data"])]),t[20]||(t[20]=e("h2",{style:{"font-family":"Almarai","font-weight":"600","font-style":"Bold","font-size":"20px","leading-trim":"CAP_HEIGHT","line-height":"100%","letter-spacing":"0%","text-align":"right","vertical-align":"middle"},class:"mt-5"}," معلومات المستلم ",-1)),u(te,{data:v.value,class:""},null,8,["data"]),u(Et,{driver:l.value?.driver,"shipment-tracking-number":l.value?.tracking_number,status:l.value?.status,onDriverAssigned:j,class:"mt-5"},null,8,["driver","shipment-tracking-number","status"])]),l.value?.driver?(r(),o("div",Ht,[u(mt,{status:l.value.status,orderInfo:l.value,class:"col-span-12 lg:col-span-12 xl:col-span-6 2xl:col-span-3"},null,8,["status","orderInfo"]),u(lt,{status:l.value.status,postponedImage:l.value.image,lat:l.value?.latitude,lng:l.value?.longitude,class:"col-span-12 lg:col-span-12 xl:col-span-6 2xl:col-span-9"},null,8,["status","postponedImage","lat","lng"]),t[21]||(t[21]=e("div",null,null,-1))])):I("",!0),u(k,{modelValue:i.value,"onUpdate:modelValue":t[5]||(t[5]=y=>i.value=y),title:"تعديل الشحنة",description:"ادخل تفاصيل الشحنة لتأكيد العملية","show-header-icon":!0,size:"large","show-footer":!1,onClose:ne},{default:G(()=>[e("div",Rt,[e("div",Zt,[e("button",{class:"w-full flex justify-between items-center p-3 bg-gray-100 rounded-t-xl",onClick:t[0]||(t[0]=y=>$("trader"))},[t[22]||(t[22]=e("span",{class:"font-semibold text-gray-800"},"معلومات التاجر",-1)),e("img",{src:S(P),alt:"",class:D(a.value==="trader"?"rotate-180":"")},null,10,Pt)]),R(e("div",Jt,[e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium mb-1"},"اختر التاجر",-1)),u(J,{name:"trader_id",options:_e.value,placeholder:"اختر التاجر",searchable:""},null,8,["options"])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium mb-1"},"مرتجع",-1)),u(J,{name:"is_return",options:ye.value,placeholder:"مرتجع"},null,8,["options"])])],512),[[Z,a.value==="trader"]])]),e("div",Kt,[e("button",{class:"w-full flex justify-between items-center p-3 bg-gray-100 rounded-t-xl",onClick:t[1]||(t[1]=y=>$("client"))},[t[25]||(t[25]=e("span",{class:"font-semibold text-gray-800"},"معلومات العميل",-1)),e("img",{src:S(P),alt:"",class:D(a.value==="client"?"rotate-180":"")},null,10,Qt)]),R(e("div",Wt,[e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium mb-1"},"اسم العميل",-1)),u(z,{name:"client_name",placeholder:"اسم العميل"})]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium mb-1"},"رقم الهاتف",-1)),u(z,{name:"client_phone",placeholder:"رقم الهاتف"})]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium mb-1"},"المنطقة",-1)),u(J,{name:"region_id",options:he.value,placeholder:"اختر المنطقة",noOptionsMessage:S(V).trader_id?" لا يوجد مناطق لهذا التاجر  ":" اختر التاجر اولا",searchable:""},null,8,["options","noOptionsMessage"])]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium mb-1"},"العنوان",-1)),u(z,{name:"address",placeholder:"العنوان"})])],512),[[Z,a.value==="client"]])]),e("div",Xt,[e("button",{class:"w-full flex justify-between items-center p-3 bg-gray-100 rounded-t-xl",onClick:t[2]||(t[2]=y=>$("shipment"))},[t[30]||(t[30]=e("span",{class:"font-semibold text-gray-800"},"تفاصيل الشحنة",-1)),e("img",{src:S(P),alt:"",class:D(a.value==="shipment"?"rotate-180":"")},null,10,Yt)]),R(e("div",es,[e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium mb-1"},"كود الشحنة",-1)),u(z,{name:"shipment_code",placeholder:"كود الشحنة"})]),e("div",null,[t[32]||(t[32]=e("label",{class:"block text-sm font-medium mb-1"},"قيمة الشحنة",-1)),u(z,{name:"products_value",type:"number",placeholder:"قيمة الشحنة"})])],512),[[Z,a.value==="shipment"]])]),e("div",ts,[e("button",{class:"w-full flex justify-between items-center p-3 bg-gray-100 rounded-t-xl",onClick:t[3]||(t[3]=y=>$("payment"))},[t[33]||(t[33]=e("span",{class:"font-semibold text-gray-800"},"معلومات الدفع",-1)),e("img",{src:S(P),alt:"",class:D(a.value==="payment"?"rotate-180":"")},null,10,ss)]),R(e("div",ls,[S(g).user?.role==="owner"?(r(),o("div",as,[t[34]||(t[34]=e("label",{class:"block text-sm font-medium mb-1"},"العمولة الإضافية",-1)),u(z,{name:"extra_commission",type:"number",placeholder:"العمولة الإضافية"})])):I("",!0),e("div",null,[t[35]||(t[35]=e("label",{class:"block text-sm font-medium mb-1"},"حالة الدفع",-1)),u(J,{name:"payment_status",options:X,placeholder:"اختر الحالة"})])],512),[[Z,a.value==="payment"]])]),s.generalError?(r(),o("div",rs,E(s.generalError),1)):I("",!0),s.successMessage?(r(),o("div",ns,E(s.successMessage),1)):I("",!0),e("div",os,[e("button",{onClick:ne,type:"button",class:"w-fit px-8 py-2 text-black bg-[#DEDEDE] rounded-[12px]"}," إلغاء "),e("button",{onClick:t[4]||(t[4]=y=>S(Se)()),type:"button",class:"w-[160px] px-4 py-2 text-white disabled:opacity-50 disabled:cursor-not-allowed bg-[#0E5895] rounded-[12px]",disabled:s.loading},[s.loading?(r(),o("span",is,"جاري ...")):(r(),o("span",us," تأكيد التعديل "))],8,ds)])])]),_:1},8,["modelValue"])],64))])}}},xs=q(cs,[["__scopeId","data-v-45e7d94e"]]);export{xs as default};
