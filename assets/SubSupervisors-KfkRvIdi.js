import{_ as te}from"./failer-Dtv5Mqu6.js";import{j as se,q as le,r as u,f as oe,y as ne,p as g,h as re,s as w,c as _,o as d,l as r,w as k,d as m,t as A,u as f,a as o,b as F,g as $}from"./index-5qBkxSW0.js";import{_ as ue}from"./ActionMenu-Bl0KP4_G.js";import{f as de}from"./formateDate-DG_0Qep_.js";import{c as ie,a as D,b as ce,u as pe,_ as S}from"./InputField.vue_vue_type_script_setup_true_lang-DUWT9aqn.js";import{r as z,a as N}from"./EyeIcon-DPoNp6EI.js";const me={class:"flex flex-col gap-4 w-full"},fe={class:"flex flex-col gap-y-1 pt-3"},ve={for:"password",class:"text-gray-700 text-sm text-start mt-4"},ye={key:0,class:"text-red-500"},_e={for:"confirm_password",class:"text-gray-700 text-sm text-start mt-4"},xe={key:0,class:"text-red-500"},be={key:0,class:"bg-red-100 rounded-[12px] flex gap-2 py-3 mt-4 px-4 items-center text-sm text-start"},he={class:"flex justify-end items-center w-full gap-2 mt-4"},ge=["disabled"],we={key:0,class:""},ke={key:1},Fe={__name:"SubSupervisors",setup(De){const x=se();le();const C=u(!1),E=u([]),M=u(""),T=u(""),O={},b=u({count:0,next:null,previous:null,page:1,pageSize:10}),Q=oe(()=>(b.value.page-1)*b.value.pageSize),j=[{label:" الاسم",key:"full_name"},{label:"رقم الهاتف",key:"phone_number"},{label:"البريد الالكتروني",key:"email"},{label:"التاريخ",key:"created"},{label:"",key:"action"}],I=a=>[{label:"تعديل",handler:()=>X(a),class:"text-black hover:bg-gray-100"},{label:"حذف",handler:()=>{s.id=a,s.site_name=E.value.find(e=>e.id===a).full_name,C.value=!0},class:"text-red-500 hover:bg-gray-100"}],s=ne({id:null,site_name:""}),G=ie({full_name:D().required("الاسم مطلوب"),phone_number:D().required("رقم الهاتف مطلوب"),email:D().email("البريد الإلكتروني غير صالح").required("البريد الإلكتروني مطلوب"),password:D().when([],{is:()=>!s.id,then:a=>a.required("كلمة المرور مطلوبة").min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل"),otherwise:a=>a.nullable().transform((e,t)=>t===""?null:e).min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل")}),confirm_password:D().when("password",{is:a=>a&&a.length>0,then:a=>a.required("تأكيد كلمة المرور مطلوب").oneOf([ce("password")],"كلمة المرور غير متطابقة"),otherwise:a=>a.nullable()})}),{handleSubmit:H,resetForm:R,setValues:J,setFieldError:q,errors:Se}=pe({validationSchema:G,initialValues:{full_name:"",phone_number:"",email:"",password:"",confirm_password:""}}),i=u(!1),c=u(!1),p=u(!1),v=u(""),K=()=>{R(),s.id=null,s.site_name="",v.value="",c.value=!1,p.value=!1,i.value=!0},B=()=>{i.value=!1,c.value=!1,p.value=!1,v.value=""},n=u(!1),P=a=>{const e=a.response?.data;v.value="",e?.code==="validation_error"&&Array.isArray(e.errors)?e.errors.forEach(t=>{x.error(t.message),q(t.field,t.message)}):e?Object.keys(e).forEach(t=>{const h=e[t],V=Array.isArray(h)?h[0]:h;q(t,V),x.error(V)}):x.error("حدث خطأ غير متوقع")},U=H(a=>{s.id?W(a):L(a)}),L=a=>{n.value=!0;const e={...a,role:"manager"};g.post("users/",e).then(t=>{n.value=!1,i.value=!1,x.success(" تم إضافة المشرف بنجاح"),y()}).catch(t=>{P(t)}).finally(()=>{n.value=!1})},W=async a=>{n.value=!0;const e={...a,role:"manager"};e.password||(delete e.password,delete e.confirm_password),g.patch(`users/${s.id}/`,e).then(t=>{x.success(" تم تعديل المشرف بنجاح"),n.value=!1,i.value=!1,y()}).catch(t=>{P(t)}).finally(()=>{n.value=!1})},X=a=>{g.get(`users/${a}/`).then(e=>{J({full_name:e.data.full_name,phone_number:e.data.phone_number,email:e.data.email,password:"",confirm_password:""}),s.id=e.data.id,s.site_name=e.data.full_name,i.value=!0,v.value="",c.value=!1,p.value=!1})},Y=async()=>{await g.delete(`users/${s.id}/`),y(),C.value=!1},y=a=>{const e=a||1;n.value=!0,g.get("users/",{params:{page:e,search:M.value||void 0,role:"manager",page_size:9}}).then(t=>{E.value=t.data.results,b.value={count:t.data.count||0,next:t.data.next,previous:t.data.previous,total_pages:Math.ceil((t.data.count||0)/10),page:e,pageSize:9}}).finally(()=>{n.value=!1})},Z=()=>{b.value.page=1,y(1)};return re(()=>{y()}),(a,e)=>{const t=w("Header"),h=w("DataFilter"),V=w("DataTable"),ee=w("GenericModal"),ae=w("DeletModal");return d(),_("div",me,[r(t,{title:"قائمة المشرفين الفرعين",buttonText:"إضافة مشرف جديد",onBtnClick:K,type:"1"}),r(h,{searchQuery:M.value,"onUpdate:searchQuery":e[0]||(e[0]=l=>M.value=l),selectedStatus:T.value,"onUpdate:selectedStatus":e[1]||(e[1]=l=>T.value=l),statusOptions:O,searchPlaceholder:"ابحث باسم المشرف  ",onFilter:Z},null,8,["searchQuery","selectedStatus"]),r(V,{headers:j,data:E.value,loading:n.value,pagination:b.value,startIndex:Q.value,onPageChange:y},{created:k(({row:l})=>[m(A(f(de)(l.created)),1)]),action:k(({row:l})=>[r(ue,{actions:I(l.id)},null,8,["actions"])]),_:1},8,["data","loading","pagination","startIndex"]),r(ee,{modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=l=>i.value=l),title:s.id?"تعديل بيانات المشرف -  ("+s.site_name+")":" إضافة مشرف فرعي جديد",description:"ادخل معلومات المشرف لتاكيد الإضافة","show-header-icon":!0,size:"large","show-footer":!1,onClose:B},{default:k(()=>[o("form",{onSubmit:e[5]||(e[5]=(...l)=>f(U)&&f(U)(...l))},[o("div",fe,[e[11]||(e[11]=o("label",{for:"full_name",class:"text-gray-700 text-sm text-start w-full"},[m(" اسم المشرف "),o("span",{class:"text-red-500"},"*")],-1)),r(S,{name:"full_name",id:"full_name",placeholder:"اسم المشرف"}),e[12]||(e[12]=o("label",{for:"phone_number",class:"text-gray-700 text-sm text-start mt-4"},[m("رقم الهاتف"),o("span",{class:"text-red-500"},"*")],-1)),r(S,{name:"phone_number",id:"phone_number",type:"tel",dir:"rtl",placeholder:"رقم الهاتف"}),e[13]||(e[13]=o("label",{for:"email",class:"text-gray-700 text-sm text-start mt-4"},[m("البريد الالكتروني "),o("span",{class:"text-red-500"},"*")],-1)),r(S,{name:"email",id:"email",type:"email",disabled:s.id,placeholder:"البريد الالكتروني"},null,8,["disabled"]),o("label",ve,[e[8]||(e[8]=m(" كلمة المرور ",-1)),s.id?F("",!0):(d(),_("span",ye,"*"))]),r(S,{name:"password",id:"password",type:c.value?"text":"password",placeholder:s.id?"اتركه فارغاً إذا لم تريد تغيير كلمة المرور":"كلمة المرور"},{suffix:k(()=>[o("button",{type:"button",onClick:e[2]||(e[2]=l=>c.value=!c.value),class:"text-gray-500"},[c.value?(d(),$(f(N),{key:1,class:"h-5 w-5"})):(d(),$(f(z),{key:0,class:"h-5 w-5"}))])]),_:1},8,["type","placeholder"]),o("label",_e,[e[9]||(e[9]=m(" تأكيد كلمة المرور ",-1)),s.id?F("",!0):(d(),_("span",xe,"*"))]),r(S,{name:"confirm_password",id:"confirm_password",type:p.value?"text":"password",placeholder:s.id?"اتركه فارغاً إذا لم تريد تغيير كلمة المرور":"تأكيد كلمة المرور"},{suffix:k(()=>[o("button",{type:"button",onClick:e[3]||(e[3]=l=>p.value=!p.value),class:"text-gray-500"},[p.value?(d(),$(f(N),{key:1,class:"h-5 w-5"})):(d(),$(f(z),{key:0,class:"h-5 w-5"}))])]),_:1},8,["type","placeholder"]),v.value?(d(),_("span",be,[e[10]||(e[10]=o("img",{src:te,alt:"",class:"h-6"},null,-1)),m(" "+A(v.value),1)])):F("",!0),o("div",he,[o("button",{type:"button",onClick:e[4]||(e[4]=l=>i.value=!1),class:"w-fit px-8 py-2 min-h-[48px] text-black bg-[#DEDEDE] rounded-[12px] focus:outline-none focus:shadow-outline"}," إلغاء "),o("button",{type:"submit",class:"w-[160px] px-4 py-2 min-h-[48px] text-white disabled:opacity-50 disabled:cursor-not-allowed bg-[#0E5895] rounded-[12px] focus:outline-none focus:shadow-outline",disabled:n.value},[n.value?(d(),_("span",we," جاري .. ")):(d(),_("span",ke,A(s.id?"تأكيد التعديل":"تأكيد الإضافة"),1))],8,ge)])])],32)]),_:1},8,["modelValue","title"]),r(ae,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=l=>C.value=l),title:"هل انت متأكد انك تريد حذف نقطة التوصيل ("+s.site_name+")",description:"سيؤدي ذلك الي حذف كل المعلومات المرتبطة به","show-confirm-button":!0,"show-cancel-button":!0,onClose:B,onConfirm:Y},null,8,["modelValue","title"])])}}};export{Fe as default};
